---
import type { GetImageResult, ImageMetadata } from "astro"
import Container from "./Container.astro"
import { GRADIENTS } from "@/consts"
import { getImage } from "astro:assets"

type Props = {
  backgroundImage?: ImageMetadata
  gradient?: string
  class?: string
  element?: "section" | "div" | "main"
  id?: string
}

const {
  backgroundImage,
  gradient = GRADIENTS.reversed,
  element: Element = "section",
  class: className,
  ...restProps
} = Astro.props

let optimizedBackgroundImage: GetImageResult | undefined

if (backgroundImage !== undefined) {
  optimizedBackgroundImage = await getImage({
    src: backgroundImage,
    quality: "high",
  })
}

// https://astro.build/blog/images/

const image = `url('${optimizedBackgroundImage?.src}')`

const bgImg = [gradient, image].filter(Boolean).join(", ")
---

<Element
  class="w-full top-0 min-h-screen z-0 bg-cover bg-center bg-no-repeat flex h-full items-center"
  style={`background-image: ${bgImg}`}
  {...restProps}
>
  <Container
    class:list={[
      "flex flex-col gap-16 md:gap-24 lg:gap-32 sticky bottom-40 h-full justify-center min-h-screen place-content-center",
      className,
    ]}
  >
    <slot />
  </Container>
</Element>
